package Blockchain;


import org.web3j.crypto.Credentials;
import org.web3j.crypto.WalletUtils;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.DefaultBlockParameter;
import org.web3j.protocol.core.methods.response.EthGetBalance;
import org.web3j.protocol.core.methods.response.TransactionReceipt;
import org.web3j.protocol.http.HttpService;
import org.web3j.tx.Contract;
import org.web3j.tx.RawTransactionManager;
import org.web3j.tx.TransactionManager;
import org.web3j.tx.Transfer;
import org.web3j.utils.Convert;


import java.io.File;
import java.io.IOException;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.nio.charset.Charset;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.Locale;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.TimeoutException;

public class SmartContractConnection {
    public static <bal> void main(String[] args) throws Exception {

        BigInteger gasPrice = BigInteger.valueOf(20000000000L);
        BigInteger gasLimit = BigInteger.valueOf(6721975L);
        Web3j client = Web3j.build(new HttpService("http://localhost:7545"));
        String contractAddress = "0x1BBfcDb27d7aB7fE1F7C8B20Ce41cf74d7d54Ce6";
        String abi = Files.readString(Path.of("/Users/ajinkyarajguru/Documents/Topics_in_DB/DecentralizedStore/src/main/resources/Solidity/FileStore.abi"), Charset.defaultCharset());
        String bytecode = "608060405234801561001057600080fd5b50611002806100206000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c80632e6439451461005c5780633080f0d714610078578063b4460b8014610096578063cc4516e5146100c7578063e9b9a095146100e3575b600080fd5b6100766004803603810190610071919061079d565b610115565b005b6100806101d5565b60405161008d919061082e565b60405180910390f35b6100b060048036038101906100ab9190610849565b6101e2565b6040516100be929190610911565b60405180910390f35b6100e160048036038101906100dc9190610a53565b6102a4565b005b6100fd60048036038101906100f89190610849565b61035d565b60405161010c93929190610bea565b60405180910390f35b600080836040516101269190610c6b565b90815260200160405180910390209050600081600001805461014790610cb1565b905011610189576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161018090610d2e565b60405180910390fd5b80600201829080600181540180825580915050600190039060005260206000200160009091909190915090816101bf9190610efa565b5080600201805490508160010181905550505050565b6000600180549050905090565b60008180516020810182018051848252602083016020850120818352809550505050505060009150905080600001805461021b90610cb1565b80601f016020809104026020016040519081016040528092919081815260200182805461024790610cb1565b80156102945780601f1061026957610100808354040283529160200191610294565b820191906000526020600020905b81548152906001019060200180831161027757829003601f168201915b5050505050908060010154905082565b60006040518060600160405280858152602001848152602001838152509050806000856040516102d49190610c6b565b908152602001604051809103902060008201518160000190816102f79190610efa565b5060208201518160010155604082015181600201908051906020019061031e929190610569565b509050506001849080600181540180825580915050600190039060005260206000200160009091909190915090816103569190610efa565b5050505050565b606060006060600080856040516103749190610c6b565b908152602001604051809103902060405180606001604052908160008201805461039d90610cb1565b80601f01602080910402602001604051908101604052809291908181526020018280546103c990610cb1565b80156104165780601f106103eb57610100808354040283529160200191610416565b820191906000526020600020905b8154815290600101906020018083116103f957829003601f168201915b505050505081526020016001820154815260200160028201805480602002602001604051908101604052809291908181526020016000905b828210156104fa57838290600052602060002001805461046d90610cb1565b80601f016020809104026020016040519081016040528092919081815260200182805461049990610cb1565b80156104e65780601f106104bb576101008083540402835291602001916104e6565b820191906000526020600020905b8154815290600101906020018083116104c957829003601f168201915b50505050508152602001906001019061044e565b5050505081525050905060008160000151511161054c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161054390610d2e565b60405180910390fd5b806000015181602001518260400151935093509350509193909250565b8280548282559060005260206000209081019282156105b1579160200282015b828111156105b05782518290816105a09190610efa565b5091602001919060010190610589565b5b5090506105be91906105c2565b5090565b5b808211156105e257600081816105d991906105e6565b506001016105c3565b5090565b5080546105f290610cb1565b6000825580601f106106045750610623565b601f0160209004906000526020600020908101906106229190610626565b5b50565b5b8082111561063f576000816000905550600101610627565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6106aa82610661565b810181811067ffffffffffffffff821117156106c9576106c8610672565b5b80604052505050565b60006106dc610643565b90506106e882826106a1565b919050565b600067ffffffffffffffff82111561070857610707610672565b5b61071182610661565b9050602081019050919050565b82818337600083830152505050565b600061074061073b846106ed565b6106d2565b90508281526020810184848401111561075c5761075b61065c565b5b61076784828561071e565b509392505050565b600082601f83011261078457610783610657565b5b813561079484826020860161072d565b91505092915050565b600080604083850312156107b4576107b361064d565b5b600083013567ffffffffffffffff8111156107d2576107d1610652565b5b6107de8582860161076f565b925050602083013567ffffffffffffffff8111156107ff576107fe610652565b5b61080b8582860161076f565b9150509250929050565b6000819050919050565b61082881610815565b82525050565b6000602082019050610843600083018461081f565b92915050565b60006020828403121561085f5761085e61064d565b5b600082013567ffffffffffffffff81111561087d5761087c610652565b5b6108898482850161076f565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156108cc5780820151818401526020810190506108b1565b60008484015250505050565b60006108e382610892565b6108ed818561089d565b93506108fd8185602086016108ae565b61090681610661565b840191505092915050565b6000604082019050818103600083015261092b81856108d8565b905061093a602083018461081f565b9392505050565b61094a81610815565b811461095557600080fd5b50565b60008135905061096781610941565b92915050565b600067ffffffffffffffff82111561098857610987610672565b5b602082029050602081019050919050565b600080fd5b60006109b16109ac8461096d565b6106d2565b905080838252602082019050602084028301858111156109d4576109d3610999565b5b835b81811015610a1b57803567ffffffffffffffff8111156109f9576109f8610657565b5b808601610a06898261076f565b855260208501945050506020810190506109d6565b5050509392505050565b600082601f830112610a3a57610a39610657565b5b8135610a4a84826020860161099e565b91505092915050565b600080600060608486031215610a6c57610a6b61064d565b5b600084013567ffffffffffffffff811115610a8a57610a89610652565b5b610a968682870161076f565b9350506020610aa786828701610958565b925050604084013567ffffffffffffffff811115610ac857610ac7610652565b5b610ad486828701610a25565b9150509250925092565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600082825260208201905092915050565b6000610b2682610892565b610b308185610b0a565b9350610b408185602086016108ae565b610b4981610661565b840191505092915050565b6000610b608383610b1b565b905092915050565b6000602082019050919050565b6000610b8082610ade565b610b8a8185610ae9565b935083602082028501610b9c85610afa565b8060005b85811015610bd85784840389528151610bb98582610b54565b9450610bc483610b68565b925060208a01995050600181019050610ba0565b50829750879550505050505092915050565b60006060820190508181036000830152610c0481866108d8565b9050610c13602083018561081f565b8181036040830152610c258184610b75565b9050949350505050565b600081905092915050565b6000610c4582610892565b610c4f8185610c2f565b9350610c5f8185602086016108ae565b80840191505092915050565b6000610c778284610c3a565b915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610cc957607f821691505b602082108103610cdc57610cdb610c82565b5b50919050565b7f536572766572206e6f7420666f756e6400000000000000000000000000000000600082015250565b6000610d1860108361089d565b9150610d2382610ce2565b602082019050919050565b60006020820190508181036000830152610d4781610d0b565b9050919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302610db07fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610d73565b610dba8683610d73565b95508019841693508086168417925050509392505050565b6000819050919050565b6000610df7610df2610ded84610815565b610dd2565b610815565b9050919050565b6000819050919050565b610e1183610ddc565b610e25610e1d82610dfe565b848454610d80565b825550505050565b600090565b610e3a610e2d565b610e45818484610e08565b505050565b5b81811015610e6957610e5e600082610e32565b600181019050610e4b565b5050565b601f821115610eae57610e7f81610d4e565b610e8884610d63565b81016020851015610e97578190505b610eab610ea385610d63565b830182610e4a565b50505b505050565b600082821c905092915050565b6000610ed160001984600802610eb3565b1980831691505092915050565b6000610eea8383610ec0565b9150826002028217905092915050565b610f0382610892565b67ffffffffffffffff811115610f1c57610f1b610672565b5b610f268254610cb1565b610f31828285610e6d565b600060209050601f831160018114610f645760008415610f52578287015190505b610f5c8582610ede565b865550610fc4565b601f198416610f7286610d4e565b60005b82811015610f9a57848901518255600182019150602085019450602081019050610f75565b86831015610fb75784890151610fb3601f891682610ec0565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220c88cf3b630f40ad01b2b63cb2477ed08078eb0438415c76b2fc29da1bc708ebe64736f6c63430008120033";
        Credentials credentials = Credentials.create("0x0e77fc49806f625e4486455a1e4c3ef3565552583617364232935e26ec50285b");
        TransactionManager transactionManager = new RawTransactionManager(client,credentials);

        Transfer transfer = new Transfer(client,transactionManager);
        TransactionReceipt transactionReceipt = transfer.sendFunds(
                "0x77B7A36EE890a3eb085D4f19201fa0cE91166Cfd",
                BigDecimal.ONE,
                Convert.Unit.ETHER,
                gasPrice,
                gasLimit
        ).send();



        final String add = "0xA9aD9dF286B94c602Fa9989bc819c651376657f5";
        EthGetBalance bal = client.ethGetBalance(add, DefaultBlockParameter.valueOf("latest")).sendAsync().get(10, TimeUnit.SECONDS);


        BigInteger balresp = bal.getBalance();
        System.out.println(balresp);
//    HelloWorld helloWorld = HelloWorld.load("your_contract_address", web3j, Credentials.create("your_private_key"), new DefaultGasProvider());
// if (helloWorld.isValid()) {
//        greeting = helloWorld.greeting().send();
//    }
// web3j.shutdown();
    }
}
